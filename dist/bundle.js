(()=>{"use strict";function t(e){if(null==e||!1===e)return document.createTextNode("");if("string"==typeof e||"number"==typeof e||!0===e)return document.createTextNode(e);if(Array.isArray(e)){const c=document.createDocumentFragment();return e.forEach(e=>{c.appendChild(t(e))}),c}const c=document.createElement(e.tag);return e.cls&&[].concat(e.cls).forEach(t=>{c.classList.add(t)}),e.attrs&&Object.keys(e.attrs).forEach(t=>{c.setAttribute(t,e.attrs[t])}),e.content&&c.appendChild(t(e.content)),c}class e{constructor(t){if(!(t instanceof HTMLElement))throw new Error("передана не HTML элемент");this.element=t,this.oponCards=[],this.deck=this.createDeck(),this.buttonRestart=document.querySelector(".btn-restart"),this.buttonRestart.addEventListener("click",()=>{this.onClickButtonRestart()}),this.cards=document.querySelector(".card-deck"),this.cards.addEventListener("click",t=>{this.onClickCard(t)})}onClickCard(t){if(t.target.classList.contains("card-back")){const e=t.target.dataset.index;if(!this.oponCards.includes(e)){this.oponCards.push(e);const c=this.cardsForGame[e];this.renderCardOne(t.target,c),this.checkCardsMatch()}}}checkCardsMatch(){if(this.oponCards.length%2==0){const[t,e]=this.oponCards,c=this.cardsForGame[t],a=this.cardsForGame[e];c.rank===a.rank&&c.suit===a.suit?this.checkGameOver():alert("Вы проиграли!")}}checkGameOver(){this.oponCards.length===this.cardsForGame.length&&alert("Поздравляем!Вы выйграли!")}onClickButtonRestart(){this.element.innerHTML="",new c(this.element)}createDeck(){let t=[];const e=[6,7,8,9,10,"J","Q","K","A"],c=["clubs","diamonds","hearts","spades"];for(const a of c)for(const c of e)t.push({rank:c,suit:a});this.shuffleDeck(t),this.selectCardByLevel(t),this.cardsForGame=this.createDuble(t),this.shuffleDeck(this.cardsForGame),window.application.cards=this.cardsForGame,this.render(),setTimeout(()=>{this.renderCardCover()},5e3)}selectCardByLevel(t){t.length={1:3,2:6,3:9}[this.level]||3}createDuble(t){const e=[];return t.forEach(t=>{e.push(t),e.push({...t})}),e}renderCardCover(){const t=this.element.querySelectorAll(".card");return t.forEach((t,e)=>{t.innerHTML="",t.classList.add("card-back"),t.dataset.index=e}),t}shuffleDeck(t){for(let e=t.length-1;e>0;e--){const c=Math.floor(Math.random()*(e+1));[t[e],t[c]]=[t[c],t[e]]}}renderCardOne(c,a){const n=t(e.templateCard(a));c.classList.remove("card-back"),c.appendChild(n)}render(){const c=t(e.template(this.cardsForGame));this.element.appendChild(c)}static template(t){return{tag:"div",cls:"cards",content:[{tag:"div",cls:"control-panel",content:[{tag:"div",cls:"timer-box",content:[{tag:"div",cls:"timer-artical",content:[{tag:"div",cls:"timer-artical-sec",content:"sek"},{tag:"div",cls:"timer-artical-sec",content:"min"}]},{tag:"div",cls:"timer-watch",content:"00.00"}]},{tag:"button",cls:"btn-restart",content:"Начать заново"}]},{tag:"div",cls:"card-deck",content:t.map(t=>({tag:"div",cls:"card",content:[{tag:"div",cls:"card-box-up",content:{tag:"div",cls:"card-small-box",content:[{tag:"div",cls:"card-name",content:t.rank},{tag:"div",cls:["card-small-suit",`card-small-suit_${t.suit}`]}]}},{tag:"div",cls:["cart-suit",`cart-suit_${t.suit}`]},{tag:"div",cls:"card-box-down",content:{tag:"div",cls:"card-small-box-reverse",content:[{tag:"div",cls:"card-name",content:t.rank},{tag:"div",cls:["card-small-suit",`card-small-suit_${t.suit}`]}]}}]}))}]}}static templateCard(t){return[{tag:"div",cls:"card-box-up",content:{tag:"div",cls:"card-small-box",content:[{tag:"div",cls:"card-name",content:t.rank},{tag:"div",cls:["card-small-suit",`card-small-suit_${t.suit}`]}]}},{tag:"div",cls:["cart-suit",`cart-suit_${t.suit}`]},{tag:"div",cls:"card-box-down",content:{tag:"div",cls:"card-small-box-reverse",content:[{tag:"div",cls:"card-name",content:t.rank},{tag:"div",cls:["card-small-suit",`card-small-suit_${t.suit}`]}]}}]}}class c{constructor(t){if(!(t instanceof HTMLElement))throw new Error("передана не HTML элемент");this.element=t,this.onHendlerClickLevel=this.onHendlerClickLevel.bind(this),this.onHendkerClickStart=this.onHendkerClickStart.bind(this),this.render(),this.level=t.querySelector(".card-level-box"),this.buttonChoice=t.querySelector(".card-level-button"),this.levelItems=t.querySelector(".card-level-box").querySelectorAll(".card-level-item"),this.level.addEventListener("click",this.onHendlerClickLevel),this.buttonChoice.addEventListener("click",this.onHendkerClickStart)}render(){const e=t(c.template());this.element.appendChild(e)}onHendkerClickStart(){this.element.innerHTML="",console.log(`Вы выбрали уровень "${window.application.level}"!`),new e(this.element)}onHendlerClickLevel(t){if(!t.target.classList.contains("card-level-item"))return;this.levelItems.forEach(t=>{t.classList.remove("card-level-item-choice")}),t.target.classList.add("card-level-item-choice");const e=t.target.textContent;window.application.level=e,localStorage.setItem("level-card-game",e),this.buttonChoice.removeAttribute("disabled")}static template(){return{tag:"div",cls:"card-box",content:[{tag:"h6",cls:"card-level-text",content:"Выбери сложность"},{tag:"div",cls:"card-level-box",content:[{tag:"button",cls:"card-level-item",content:1},{tag:"button",cls:"card-level-item",content:2},{tag:"button",cls:"card-level-item",content:3}]},{tag:"button",cls:"card-level-button",content:"Старт",attrs:{disabled:!0}}]}}}document.addEventListener("DOMContentLoaded",()=>{window.application={level:null};const t=localStorage.getItem("level-card-game"),a=document.querySelector(".app");t?a&&(window.application.level=t,new e(a)):a&&new c(a)})})();